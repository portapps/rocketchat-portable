os: windows
language: shell

env:
  global:
    - GOVERSION: 1.12.4
    - NODEJS_VERSION: 11.14.0

before_install:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps
  - source ${TRAVIS_BUILD_DIR}/../portapps/.travis/prepare.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/java.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/ant.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/nodejs.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/go.sh

script:
  - ant release

after_success:
  - export APP_VERSION=$(cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat)
  - echo ${APP_VERSION}

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - export TRAVIS_TAG="${APP_VERSION}"
  - git tag $TRAVIS_TAG
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: gpEQIuZpcsWJICTSUSuDln0TneKxraEUXncUKfBzmlYz+hNtaVeMGFxtEsT80lKqQLu9H/NwksX4CGqfCfv26WHn8Erzb09Gge4tqR76aNou8uVdnnA+9kyTHvhEt2PEn9fT8Al4H9AYe8Mw87o73qNnmyBN76EeBol9Q4dTZFWulQa6C/XF7FiSQzPixNJAXZywCsYlxB4Yq7Th0jXPArTCQtP9524+YdiO24XZlkywtva9sqsUqMrH5yw8WdQ8B0DiDuKHUsruvekPJ/XkgsGVABARVBR8s9RNIaWpnsBDm6sdUwFtyCTpZ36iAGKUjWBs1rTicGf8657MND18eIihTxVWWOzVU7Ve20jqqThT7WnyTTe8dpTRsjJJYyGj2IwqerpaDnRT6sHMUCd1xeyFSutDZCEvJfED4kO8H4st9PkxNz7JqWM2FLxp/WIYheElbk8GY6iRWwzMaelbCFU7jZ/J4lYFhhrnP6FQU1EfZYll2tsU0M9s882nvVIXwTNMDagp/9PqXv2KXpcqxahrCOAWaCJ3bBoyZan6GSGVZ+be9cHcUMYYpE4qCcOAB27wLugv1C8pcZsb/8VlMjk7dIOkX05T8x9fzTc+4MqhW7+Ce/DVcHv6mOY+oe9ySyKXLXDqKc8j2w9TjpRCcu77Rtz4EzGleho3eADp1tQ=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false

notifications:
  email:
    recipients:
      - travisci@portapps.io
    on_success: always
    on_failure: always
